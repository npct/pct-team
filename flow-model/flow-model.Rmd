---
title: 'The Propensity to Cycle Tool: An open source online system for sustainable
  transport planning'
author:
- Robin Lovelace (University of Leeds)
- Anna Goodman (London School of Hygiene and Tropical Medicine)
- Rachel Aldred (University of Westminster)
- Nikolai Berkoff (independent web developer)
- Ali Abbas (University of Cambridge)
- James Woodcock (University of Cambridge)
csl: ../documents/elsevier-harvard.csl
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
  html_document: default
  word_document: default
header-includes: \usepackage{amsmath} \usepackage{longtable} \usepackage{booktabs}
  \usepackage{setspace} \doublespacing \usepackage{lscape} \usepackage{rotating} \usepackage{tabularx} \usepackage{tabu}
  \newcommand{\blandscape}{\begin{landscape}} \newcommand{\elandscape}{\end{landscape}}
  \usepackage{caption} \captionsetup[table]{skip=10pt}
fontsize: 12pt
bibliography: references.bib
---

```{r, echo=FALSE}
library(knitr)
opts_chunk$set(out.width = '100%')
```

```{r, echo=FALSE, include=FALSE}
# date: '`r format(Sys.time(), ''%d %B %Y'')`'
# output:
#   pdf_document:
#     fig_caption: yes
#     number_sections: yes
#     toc: yes
# header-includes: \usepackage{amsmath}
#                  \usepackage{longtable}
#                  \usepackage{booktabs}

# output: rticles::els_article
if(grepl(pattern = "pct$", x = getwd())){
  setwd("documents")
}
# source("../set-up.R")
pkgs <- c("stplanr", "knitr", "xtable", "sp", "grid", "png", "RefManageR")
to_install <- !vapply(pkgs, require, character.only = T, FUN.VALUE = logical(1))
if(to_install) install.packages(pkgs[to_install])

# Bibliography dl
# generated via https://github.com/ZotPlus/zotero-better-bibtex
# downloader::download("https://www.zotero.org/api/groups/418217/collections/JBXTRB93/items/top?limit=100&format=bibtex&v=1", destfile = "references.bib")
# RefManageR::ReadZotero()
# # This is from the group 'energy-and-transport': https://www.zotero.org/groups/energy-and-transport/

# To do:
# Add speed-bumps/speed cameras/cycling priority or remove lanes for motorised traffic
# Mention how the PCT could be used to create a systematic evidence base
```

# Abstract {-}

Getting people cycling is an increasingly common objective in transport planning institutions worldwide. 
A growing evidence base indicates that high quality infrastructure 
can boost local cycling rates.
Yet for infrastructure and other cycling measures to be effective,
it is important to intervene in the right places, such as along 'desire lines' of high latent demand.
This creates the need for tools and methods to help answer the question 'where to build?'. 
Following a brief review of the policy and research context related to this question,
this paper describes the design, features and potential applications of such a tool.
The Propensity to Cycle Tool (PCT) is an online, interactive planning support system which was
initially developed to explore and map cycling potential across England
(see [www.pct.bike](http://pct.bike/)).
Based on origin-destination data, it models and visualises
cycling levels at area, desire line, route and route network levels,
for current levels of cycling, and for scenario-based 'cycling futures'.
Scenarios implemented so far include 'Go Dutch' and 'Ebikes', which
explore what would happen if English people cycled as much as the Dutch and the potential impact of electric cycles on cycling uptake.
The PCT is open source, enabling the creation of additional scenarios by others
and its deployment in new contexts.
We conclude that the PCT illustrates the potential of online tools to
inform transport decisions and relates to the wider issue
of how models should be used in transport planning.

# Introduction

Cycling can play an important role in creating
sustainable and equitable transport systems.
Cycling already provides reliable, healthy, affordable,
and convenient mobility to millions of people each day [@komanoff_bicycling_2004] and
is one of the fastest growing modes of transport in some large, cosmopolitan cities such as London,
New York and Barcelona [@fishman_cycling_2016].
There is mounting evidence about the external costs of car-dominated
transport systems [@newman_costs_1999;@han_assessment_2008;@mizutani_estimation_2011;@shergold_rural_2012],
and the benefits of cycling [@oja_health_2011;@de_nazelle_improving_2011;@tainio_can_2016],
pushing cycling up the transport policy agenda.
In this context there is growing interest, and in some cases substantial investment,
in cycling infrastructure, including in countries
with historically low rates of cycling.

<!-- ^[ -->
<!-- Several examples -->
<!-- of multi-million Euro projects are provided by the -->
<!-- [European Cyclist' Federation](http://www.ecf.com/advocary/eu-funding-2/examples-of-cycling-projects-co-funded-by-the-eu/), the -->
<!-- [FIA Foundation](http://www.unep.org/transport/sharetheroad/PDF/SharetheRoadReportweb.pdf) and the -->
<!-- [World Cycling Atlas](http://www.worldwidecyclingatlas.com/). -->
<!-- Another illustration of increased interest in cycling investment is provided by -->
<!-- the proliferation of publicly subsidised 'bike share' -->
<!-- [@obrien_mining_2014], which can be viewed in an interactive map at -->
<!-- [bikes.oobrien.com](http://bikes.oobrien.com). -->
<!-- ] -->

Providing high-quality infrastructure can play a key role in promoting cycling uptake [@parkin_cycling_2012].
Off-road cycle paths, for example, have been found to be  associated with an increased share of commute trips made by cycling locally [@heinen_changes_2015].
Overall there is growing evidence linking cycling infrastructure to higher rates of cycling [@buehler_bikeway_2016].
But where should this infrastructure be built? This paper seeks to demonstrate the potential of online, evidence-based tools to help answer this
question, with reference to the Propensity to Cycle Tool (PCT).
The PCT is an online planning support system funded by the UK's Department for Transport
to map cycling potential (Department for Transport, 2015).

<!-- The version described in the paper was deployed for England (PCT-England) but we envision additional versions being developed for other countries and cities. -->

<!-- And where are local policy interventions --- such as reducing speed limits, enforcing road traffic laws, creating cycle hire schemes, providing free cycle training and reallocating road space for walking and cycling --- likely to have the greatest impact? -->

```{r, echo=FALSE}
# As such, rather than focus on the specific policy and geographical context of the PCT's development, we endeavour to present the tool in a generalisable way.
# 
# The paper is structured as follows. The Literature Review (Section 2) provides an overview of existing tools for the prioritisation of investment in cycling and active travel. Section 3 describes the data and methods underlying the PCT, with reference to a technical Appendix. Section 4 provides an outline of the scenarios developed for the DfT with reference to alternative scenarios that could be envisioned using the PCT. Finally, in Section 5, we discuss some of the limitations of the approach taken in the developement of the PCT and outline promising directions for future research and development in the nascent area of planning support systems for sustainable transport.
```

# The Propensity to Cycle Tool in context

The PCT was developed in the context of growing policy interest directed towards cycling, alongside two branches of academic research:
a) methodological developments for estimating cycling potential and b) Planning Support Systems (PSS).
The subsequent overview of this policy and academic landscape places the PCT in its wider context.

## The policy context

A number of factors influence
the attractiveness of cycling for everyday trips [@pucher_infrastructure_2010].
There is a wide range of interventions related to infrastructure that can be grouped under the banner 'space for cycling' [@parkin_planning_2015].
These include reducing speed limits, implementing car free zones and allowing cycles to move more freely than motorised traffic (e.g. with early-start traffic lights and barriers passable only by pedestrians and cycles).
However, the intervention that has received the most attention has been the construction of new cycle paths.
In the UK context, devolved transport budgets mean that local authorities have some control over the design and implementation of cycling networks, a potentially powerful policy lever to get people cycling.

Planning new cycle paths requires many decisions to be made, including in relation to the width [@wegman_urban_1979;@pikora_developing_2002], quality [@heath_effectiveness_2006], directness [@crow_design_2007] and geographic location of the paths.
Yet while much guidance has been produced regarding the physical design of cycle paths [e.g. @transport_for_london_london_2015;@welsh_government_guidance_2014],
little work has explicitly tackled the question of where this high quality infrastructure should be built
[@aultman-hall_analysis_1997;@minikel_cyclist_2012].
Within this policy context, the PCT focuses explicitly on the question of *where* to build rather than *what* to build, although it does provide evidence on potential capacity requirements across the route network.

<!-- A wider issue related to the broader sustainable urban mobility question is that the tools and concepts within the 'predict and provide' paradigm have limited capacity to inform 'sustainable mobility' policies [@naess_transport_2014]. -->

## Research into cycling potential 

The growing evidence base regarding the impact of infrastructure on cycling raises the question of how to 'operationalise' this body knowledge, to help planners prioritise where to invest.
This research gap was described by
@larsen_build_2013, who identified an "absence of research into how 
to  systematically  prioritise  and  locate  facilities  that  are  to  be  built".
There is, however, an emerging literature exploring cycling potential.
This links to the question of 'where to build' because 
areas and routes with the highest potential are likely to be cost-effective places for investment.
With the notable exceptions of @larsen_build_2013 and @zhang_prioritizing_2014, this body of research has not provided systematic or quantitative evidence for transport planners.
The methods broadly
fit into three categories depending on the level of the input data used:

- Area-based measures are based primarily on data at the level of administrative zones. Outputs from these measures can assist with the location of site-specific transport infrastructure such as cycle parking.

- Individual-based measures are based on individual level survey data, typically a household travel survey. These are not always geographically specific and tend to be used to identify and categorise demographic groups in relation to cycling, such as near-market or as warranting tailored interventions, such as targeted cycle training schemes.

- Route-based measures use origin-destination data which can be used to create 'desire lines' and (using route allocation) estimates of existing and potential demand at each point on the road network.

This work is reviewed in relation to the PCT below and summarised in Table 1.

<!-- ### Area-based measures of cycling potential -->

@parkin_estimation_2008 presented an area-based measure of cycling potential that used a regression model to estimate the proportion of commuter trips cycled across wards in England and Wales. Factors associated with lower levels of cycling included road defects, high rainfall, hills and a higher proportion of ethnic minority and low-income inhabitants.  Parkin et al. concluded that policy makers must engage with a mixture of physical and social barriers to promote cycling effectively, with the implication that some areas have lower barriers to cycling --- and hence higher propensity to cycle --- than others.

@zhang_prioritizing_2014 created an individual-based model of cycling potential to prioritise where to build cycle paths to "achieve maximum impacts early on".
The outputs of this model were aggregated to the level of 67 statistical zones in the study area of Belo Horizonte, Brazil, and used to generate a 'usage intensity index' for potential cycle paths.
This, combined with survey data on cyclists' stated preferences on whether people would cycle were infrastructure provided along particular routes and origin-destination data on travel to work, was used to rank key routes in the city in terms of their cycling potential.

<!-- ### Individiual-based measures of cycling potential -->
<!-- Another method that used individual-level to identify areas with high numbers of -->
<!-- 'potentially cycleable trips' funded by London's transport authority [@transport_for_london_analysis_2010]. -->
<!-- This method was based primarily on the London Travel Demand Survey and analysed -->
<!-- which segments of the population were most willing to cycle. The results were -->
<!-- presented as a static heatmap and used to prioritise where to build new cycle -->
<!-- paths and cycle hire points. -->

While the methods presented by Parkin et al. (2008) and Zhang et al. (2014) were developed in an academic context, albeit closely related to policy needs and interests, the
Analysis of Cycling Potential (ACP) tool was developed by practitioners [@transport_for_london_analysis_2010]. The ACP combined area and individual-level data to produce a heat map estimating cycling potential across London, UK, for all trip purposes. The underlying model examined which types of trips are most likely to be cycled, based on the characteristics of observed cycle trips (e.g. time of day, characteristics of the traveller, distance).
The results of the ACP have informed local cycling schemes, such as where to build new cycle hire stations.
The ACP does not use origin-destination data directly or route allocation.

Again working within academia but also closely focused on local planning and policy issues,
@larsen_build_2013 created
an area-based 'prioritization index', for Montreal, Canada.
This was based on four variables: the area's current level of cycling,
its cycling potential (estimated based on the shortest path between the origin and destination of short car trips from a travel survey), the number of injuries to cyclists,
and locations prioritised by current cyclists for improvement  [@larsen_build_2013].
The method used to combine these four sources was rasterisation, whereby
the information was aggregated to the level of evenly spread cells covering the study area.
The resulting heat map was used to recommend the construction or upgrade of cycle paths on specific roads.

A more localised approach is the Permeability Assessment Tool (PAT), which was developed by a transport consultancy @payne_removing_2014.
The PAT is based on the concept of 'filtered permeability', which means providing a more direct route to people cycling than driving [@melia_urban_2015].
The PAT works by combining geographical data, including the location of popular destinations
and existing transport infrastructure, with on-site audit data of areas that have
been short-listed. Unlike the prioritisation index of Larsen et al. (2013), which is primarily aimed at informing a city-wide strategic cycling network, the results of the PAT are designed to guide smaller, site specific interventions such as 'contraflow' paths and cyclist priority traffic signals.


<!-- A key feature of this tool was its integration of data sources from many different sources. -->
<!-- Unlike @larsen_build_2013, @zhang_prioritizing_2014  Using socio-demographic data, groups who were most likely to cycle were identified.  -->

<!-- Route-allocation of the desire lines. This facilitates the identification of specific segments of the transport network to be targeted for improvement. Such an approach has considerable potential for creating an evidence-base for prioritising investment in cycle paths locally (Broach et al., 2012; Ehrgott et al., 2012), for example by []. -->

<!-- \newpage -->

```{r, echo=FALSE, results='asis'}
dft = readr::read_csv("../data-sources/160516_cycle-tools.csv")
# knitr::kable(dft)
library(pander)
# pander(dft, split.table = Inf)
# stargazer::stargazer(dft, summary = FALSE)
library(xtable)
xt = xtable(dft, caption = "Summary of tools and methods to prioritise where to invest in cycling.")
align(xt) = "Xp{3cm}|p{2cm}p{2cm}XXp{1.8cm}"
print(xt, comment = FALSE, include.rownames = FALSE,  hline.after = 0:nrow(dft),
  tabular.environment = "tabularx", width = "\\textwidth", booktabs = T, caption.placement = "top")
```

<!-- \newpage -->
<!-- \elandscape -->

## Planning support systems

The methods and tools for estimating cycling potential outlined in Table 1 were generally created with only a single study region in mind. The benefit of this is that they can respond context-specific to practitioner and policy needs.
However, the aim of the PCT was to provide a *generalisable* and *scalable* tool.
To do so we drew on the tradition of Planning Support Systems (PSS).

PSS were initially developed to encourage evidence-based policy in land-use planning [e.g. @klosterman_what_1999].
The application of PSS to transport planning has been more recent, with a goal of
"systematically [introducing] relevant (spatial) information to a
specific process of related planning actions" [@te_brommelstroet_developing_2008].
The PCT is systematic in its use of national data for all parts of the study region
(in this case England) and relates to a specific planning process --- the creation of new and enhancement of existing cycle infrastructure.

PSS typically work by presenting evidence about the characteristics and needs
of study region in an interactive map.
A central objective is to visualise
alternative scenarios of the future and explore their potential impacts.
The results of traditional scenario-based models of the future 
are typically not presented locally at area, let-alone route-specific, levels
[@mccollum_achieving_2009;@lovelace_assessing_2011;@woodcock_public_2009].
Online PSS can overcome this issue by using interactive maps to show local manifestations
of different scenarios [@pettit_online_2013].
The emergence of libraries for web mapping  [@haklay_web_2008] has facilitated online PSS, offering the potential for public access to the planning process. Transparency is further enhanced by making PSS open source, in-line with a growing trend in transport modelling [@tamminga_design_2012;@novosel_agent_2015;@borning_urbansim:_2008].  In these ways, PSS can make evidence for transport planning more widely available, and tackle the issue that transport models are sometimes seen as 'black boxes', closed to public scrutiny (Golub et al., 2013).


<!-- allowing public access to the planning process. -->
<!-- Linked with the proliferation of open source software in transport planning -->
<!-- [@tamminga_design_2012;@novosel_agent_2015;@borning_urbansim:_2008], -->
<!-- PSS can tackle the issue that transport models are often seen as -->
<!-- 'black boxes', closed to public scrutiny [@golub_making_2013], by making -->
<!-- evidence for transport planning more widely available. -->

<!--' Much has been written about the characteristics of an effective PSS -->
<!--' of relavence to the PCT. -->
<!--' Although PSS are primarily technical projects to *develop*, -->
<!--' it has been found that 'soft' factors can impede their utility for practitioners. -->
<!--' In a review of the effectiveness of PSS uptake in the Netherlands, -->
<!--' @brommelstroet_equip_2010 identified timing and limited options for scenario -->
<!--' developement as key 'bottlenecks'. -->
<!--' These insights from the PSS literature influenced the design of the PCT -->
<!--' and the critique of PSS that practitioners should be more involved in -->
<!--' their development is returned to in the Discussion. -->

```{r, echo=FALSE}
# The policy relevance of this work stems from local and national cycling targets, wich are often set in terms of mode share. However, with little insight into what meeting these targets would mean for the rate of cycling flows along specific routes, it is hard to translate ambitious targets  into specific policies and plans. The PCT provides, to the authors' knowledge, the first online and interactive planning support system that tackles these issues for cycling.
```

```{r, echo=FALSE, eval=FALSE}
Other innovative features of the PCT include:
Estimation and visualisation of cycling potential at both the ‘area’ level and the 'desire line' level. This contrasts with most previous models of modal shift, which typically only produce outputs the area level (e.g. Lovelace et al., 2011; Müller et al., 2008). In relation to cycling, Parkin et al. (2008) used a multiple regression model to estimate levels of commuter cycling at an area level. Similarly local survey data has been used to identify areas with high numbers of 'potentially cycleable trips' in London (Transport for London, 2010). However, neither analysis identified the travel corridors along which these simulated cycle trips would be made.  
```

```{r, echo=FALSE, eval=FALSE}
Ability to produce outputs at multiple geographic levels.  Users of the PCT choose whether to examine cycling potential at a very local level (e.g. just a few streets) or at a more regional level (e.g. across a large metropolitan area). Line-level outputs can be aggregated to networks, while area-level outputs can be aggregated to the regional or national level.  This contrasts with previous national-level scenario-based transport models, which often lack any local geographical detail (e.g. McCollum and Yang, 2009).  In addition, the PCT is well suited to local-level analysis of the impacts of achieving a regional or national target level of cycling, highlighting one way in which this is a strategic tool.
Focus on wide ranging scenarios for cycling growth, including long-term, ambitious scenarios. This expands the 'option space' visible to transport planners, encouraging consideration of short and long-term planning horizons simultaneously.  This addresses one identified limitation of many existing models, namely that they do not simulate long-term scenarios and "do not sufficiently support the generation of new strategies" (Brommelstroet, 2010).
Making results available through a freely-accessible interface and open access model. In the past, transport planning has tended to be "closed to public over-sight", preventing public engagement with strategic transport plans (Golub et al. 2013). There is, however, now a trend in transport research towards greater transparency in software development and collaboration (Novosel et al., 2015; Tamminga et al., 2012).   The PCT is part of this trend, having been created with open access software, with the underlying code having been made publicly available under an open source AGPL licence (github.com/npct).
```

## Policy context and features of the Propensity to Cycle Tool

The national policy context of the PCT has influenced its design and features.
The PCT was commissioned by the UK's Department for Transport to identify "parts of [England] with the greatest propensity to cycle"  [@department_for_transport_response_2015].
Thus the aim was not to produce a full transport-land use model,
but to provide an evidence base to prioritise where to create cycle-friendly infrastructure based on scenarios of the future.

Local and national cycling targets are often based on a target mode share by a given date.^[The
local target in Bristol, for example, is for [20% of commuter trips to be cycled by 2020](http://www.bristolpost.co.uk/Bristol-City-Council-s-pound-35million-plan/story-21341172-detail/story.html). [Manchester](http://cycling.tfgm.com/Documents/CCAG2-Executive-Summary.pdf) (10% by 2025),
[Derbyshire](https://www.derbyshire.gov.uk/images/2015-07-07%20Item%207l%20Cycle%20Plan_tcm44-267216.pdf) (to double the number of people cycling by 2025) and [London](http://content.tfl.gov.uk/gla-mayors-cycle-vision-2013.pdf) (to 'double cycling' by 2025) provide further examples of local ambitious time-bound cycling
targets.]
However, there is little evidence about what this might mean in for cycling volumes along specific routes.
The PCT tackles this issue by estimating rate of cycling locally under different scenarios and presenting the results on an interactive map. Its key features include:

- Estimation of cycling potential at area, 'desire line' and route network levels. 

- Route-allocation of OD pairs by a routing algorithm specifically developed for cycling.
This was done by CycleStreets.net, a routing service developed by cyclists, for cyclists.

- Visualisation of outputs at multiple geographic levels. The interactive map enables users to examine cycling potential at a very local level (e.g. just a few streets) or at a more regional level (e.g. across a large metropolitan area). 

- Public accessibility of results and code. The tool is freely available online and developers are encouraged to modify the PCT (e.g. to create alternative scenarios) by provision of the source code underlying the PCT under the open source AGP License.

- The presentation of estimated benefits under future scenarios, for example via impacts on public health and carbon emissions, enabling interventions to be designed based on specific health and environmental policy goals

As with any tool, the PCT’s utility depends on people knowing how to use it.
For that reason training materials and a user manual are being developed
to show how the tool can be used
(see the 'Manual' tab in Figure 3).

# Data and methods

This section describes the data and methods that generate the input data for the PCT.
This is summarised in Figure 1 and described in detail in the Appendix.
Central to the PCT approach is origin-destination (OD) data recording the travel flow between administrative zones.
Combined with geographical data on the coordinates of the population-weighted centroid of each zones,
these can be represented as
straight 'desire lines' or as routes allocated to the transport network.

<!-- The route-allocation stage (outlined below) provides -->
<!-- hilliness and route network distance as additional variables at the OD level. -->

```{r, echo=FALSE, fig.cap="Flow diagram illustrating the input data and processing steps used to create the input data used by the PCT. The abbreviations are as follows. HEAT = Health Economic Assessment Tool, OD pair = origin-destination pair, MSOA = Middle-Layer Super Output Area"}
knitr::include_graphics("160516_Fig1.pdf")
```

## Processing OD data

The central input dataset was a table of origin-destination (OD) pairs from the 2011 Census.
This was loaded from open access file `wu03ew_v2.csv`, provided by the [UK Data Service](http://wicid.ukdataservice.ac.uk/). This captures the number of commuters travelling between Middle Super Output Area zones (MSOAs, average commuter population: 3300), by mode of travel (see Table 2).
 This dataset was derived from responses to the following questions in the [English 2011 Census](http://www.ons.gov.uk/census/): "In your main job, what is the address of your workplace?" (question 40) and "How do you usually travel to work? (Tick one box only, for the longest part, by distance, of your usual journey to work)" (Question 41).
 This dataset was enhanced by merging in information on the gender composition of cyclists in each OD pair (Dataset 1 in Figure 1); data at the area level on the background mortality rate (Dataset 2); and data at the OD pair-level on route distance (km) and hilliness (average gradient, in %) (Dataset 3).
The latter data was assigned to OD pairs using the 'fastest' option on CycleStreets.net, using the R package stplanr (Lovelace et al., 2016). See the Appendix for further details.

\begin{table}[]
\centering
\caption{Sample of the OD input dataset, representing the number of people who
commute from locations within and between administrative zones (MSOAs). Note `Car' refers people who drive as their main mode of travel per OD pair, rather than people who travel to work as a passenger in a car.}
\label{my-label}
\begin{tabular}{@{}lllllll@{}}
\toprule
                                        &                                        & \multicolumn{5}{l}{Number of commuters by main mode}                                                                 \\ \midrule
\multicolumn{1}{l}{Area of residence} & \multicolumn{1}{l}{Area of workplace} & \multicolumn{1}{l}{Total} & \multicolumn{1}{l}{Cycle} & \multicolumn{1}{l}{Walk} & \multicolumn{1}{l}{Car} & \multicolumn{1}{l}{Other} \\ \midrule
\multicolumn{1}{l}{E02002361}         & \multicolumn{1}{l}{E02002361}         & \multicolumn{1}{l}{109}   & \multicolumn{1}{l}{2}     & \multicolumn{1}{l}{59}   & \multicolumn{1}{l}{39}  & \multicolumn{1}{l}{9}     \\ 
\multicolumn{1}{l}{E02002361}         & \multicolumn{1}{l}{E02002362}         & \multicolumn{1}{l}{7}     & \multicolumn{1}{l}{1}     & \multicolumn{1}{l}{0}    & \multicolumn{1}{l}{4}   & \multicolumn{1}{l}{2}     \\ 
\multicolumn{1}{l}{E02002361}         & \multicolumn{1}{l}{E02002363}         & \multicolumn{1}{l}{38}    & \multicolumn{1}{l}{0}     & \multicolumn{1}{l}{4}    & \multicolumn{1}{l}{24}  & \multicolumn{1}{l}{10}    \\ 
\multicolumn{1}{l}{E02002361}         & \multicolumn{1}{l}{E02002364}         & \multicolumn{1}{l}{15}  & \multicolumn{1}{l}{1}     & \multicolumn{1}{l}{0}    & \multicolumn{1}{l}{10}  & \multicolumn{1}{l}{4}     \\ 
\multicolumn{1}{l}{E02002361}         & \multicolumn{1}{l}{E02002366}   & 29                         & 1                          & 10                        & 11                       & 7                          \\ \bottomrule
\end{tabular}
\end{table}

```{r tflow, echo=FALSE, results='asis'}
# For latex version: use xtable:
# t1 <- xtable(head(flow[c(1:3, 12)]), caption = "Sample of the 'flow' input dataset, representing the number of people who commute from locations within and between administrative zones (MSOAs)", label = "tbl:flow")
# print(t1, type = "latex", comment = FALSE, caption.placement = "top")

# For docx and latex: use kable
# data("flow")
# names(flow) <- gsub("\\.", " ", names(flow))
# names(flow)[3] <- "Total no. commuters"
# names(flow)[12] <- "No. cycle commuters"
# kable(head(flow[c(1:3, 12)]), row.names = F)
```

<!-- Table: Sample of the zone level input dataset. The coordinates represent the population-weighted centroids of MSOA zones, whose codes are also presented in Table 1. -->

<!-- ```{r tcents, echo=FALSE, results='asis'} -->
<!-- # t2 <- xtable(as.data.frame(cents[1:3,-c(3,4)]), caption = "Sample of the 'cents' input dataset, representing the geographical location of the population-weighted centroids of MSOA zones described in Table~\\ref{tbl:flow}", label = "tbl:cents") -->
<!-- # print(t2, type = "latex", comment = FALSE, caption.placement = "top") -->
<!-- data("cents") -->
<!-- sel <- which(cents$geo_code == flow$`Area of residence`[1]) -->
<!-- cents1 <- as.data.frame(cents[c(1:3, sel),-c(3,4)]) -->
<!-- names(cents1) <- c( -->
<!--   "Area of residence", -->
<!--   "Area name", -->
<!--   "Longitude", -->
<!--   "Latitude") -->
<!-- kable(cents1, row.names = F) -->
<!-- ``` -->

<!-- A model estimating cycling uptake as a function of distance, via distance decay curves [@iacono_access_2008], -->
<!-- and hilliness was used to create plausible scenarios of cycling futures. -->
<!-- For the purposes of this study, model parameters were derived from -->
<!-- English and Dutch travel survey data (see the Appendix). -->
<!-- Changing the height and shape of distance decay curves -->
<!-- (and, for the 'Ebike scenario, 'hilliness decay curves') -->
<!-- based on a baseline from the English National Travel Survey -->
<!-- (illustrated in Figure 2) allowed estimates of the model split -->
<!-- of cycling to be generated for every route-allocated OD pair for each scenario. -->

<!-- It is important that even in high-cycling countries such as the Netherlands there -->
<!-- is a strong relationship between cycling levels and trip distance, -->
<!-- influencing the potential for mode shift in different regions. -->
<!-- Where many trips are long and/or hilly, interventions related to land-use planning -->
<!-- (e.g. the creation of local jobs and services) may be a prerequisite for substantial cycling uptake. -->
<!-- Where many are short, by contrast, improvements to the infrastructure -->
<!-- for cycling, in tandem with 'soft' interventions such as cycle training, -->
<!-- may be sufficient for cycling levels to grow. -->
<!-- The PCT focuses explicitly on the latter scenario as it is (currently) -->
<!-- based on current travel patterns. -->

## Modelling cycling potential

The starting point for generating our scenario-based 'cycling futures' was to model current cycle commuting in England.  We did this using OD data from the 2011 Census, and modelling cycling commuting as a function of route distance and route hilliness.  We did so using logistic regression applied at the individual level, including squared and square-root terms to capture 'distance decay' --- the non-linear impact of distance on the likelihood of cycling [@iacono_access_2008] --- and including terms to capture the interaction between distance and hilliness. Model fit is illustrated in Figure 2; see Appendix for details and for the underlying equations.
We also developed equations to estimate commuting mode share among groups not represented in the between-zone ('interzonal') OD data, e.g. those commuting within a specific MSOA (this is within-zone or 'intrazonal' travel), or those with no fixed workplace. 
This model of current cycling levels formed the basis of three of the four scenarios (Government Target, Go Dutch and Ebikes; see below), with model parameterization drawing additionally on English, Dutch and Swiss travel survey data.

```{r, echo=FALSE, fig.cap="The relationship between distance (left) and hilliness (right) and cycling mode share in England based on the the 2011 Census. The plots show actual (blue) vs predicted (red) prevalence of cycling to work among 17,896,135 English commuters travelling <30km to work."}
knitr::include_graphics("dist-curve2-ag.pdf")
```


```{r, echo=FALSE}
# ^[The
# source code of `gFlow2Lines()` has been made available
# online, as part of an R package for sustainable transport planning,
# **stplanr**. See [github.com/Robinlovelace/stplanr/](https://github.com/Robinlovelace/stplanr/blob/master/R/gFlow.R).]
```

<!-- The raw OD data was preprocessed before being used in the PCT. -->
<!-- The R package **stplanr** was developed for this task [@lovelace_stplanr:_2016]. -->
<!-- Tables 1 and 2 illustrate the two tables that comprise the OD data. Figure 3 -->
<!-- shows a visualisation of the output, straight lines with attributes for -->
<!-- each OD pair in both directions. These are also referred to as 'desire lines' when -->
<!-- represented as straight lines on the map [@tobler_experiments_1987;@chan_multi-criteria_2003]. -->
<!-- The visualisation of the OD data builds -->
<!-- on published work on cartographic visualisation [@rae_spatial_2009;@wood_visualisation_2010]. -->
<!-- The model for England described here uses the following open datasets -->
<!-- (similar OD datasets are available for cities across the world): -->

<!-- - Flow data representing the number of trips between origin-destination (OD) pairs, -->
<!-- disaggregated by mode of travel. -->
<!-- We used the file `wu03ew_v2.csv`, obtained from the UK Data Service -->
<!-- (see Table 2 for a sample of this dataset)^[See [wicid.ukdataservice.ac.uk/cider/wicid/downloads.php](https://wicid.ukdataservice.ac.uk/cider/wicid/downloads.php).]  This dataset was derived by the Office for National Statistics from responses to questions 40 ("In your main job, what is the address of your -->
<!-- workplace?") and 41 ("How do you usually travel to work?") in the English 2011 Census (see [ons.gov.uk/census](http://www.ons.gov.uk/census/2011census/howourcensusworks/howwetookthe2011census/howwecollectedtheinformation/questionnairesdeliverycompletionandreturn) for further information). -->

<!-- - The population-weighted centroids of -->
<!-- administrative zones (see Table 1). Middle Super -->
<!-- Output Areas (MSOAs) (average population: 7,800) -->
<!-- were used for both origins and destinations.^[This -->
<!-- data was provided under the UK's Open Government -->
<!-- Licence [data.gov.uk/dataset/lower-layer-super-output-areas-ew-2011-population-weighted-centroids](http://data.gov.uk/dataset/lower-layer-super-output-areas-ew-2011-population-weighted-centroids).] -->

<!-- - Route distance, generated by the `route_cyclestreet` function -->
<!-- in the **stplanr** R package. -->

<!-- - Hilliness of zones and routes. There are various ways to generate this data, -->
<!-- ranging from the simple (e.g. vertical displacement between origin and -->
<!-- destination) to the complex (e.g. total amount of climb along the route network -->
<!-- in both directions). After experimenting with area-based measures of hilliness -->
<!-- we settled on a route-allocated measure: the average gradient (%) of the 'fastest' -->
<!-- route. -->

<!-- We calculated mean gradient per MSOA zone using publicly available -->
<!-- digital -->
<!-- elevation model (DEM) data supplied by NASA.^[See -->
<!-- [srtm.csi.cgiar.org/](http://srtm.csi.cgiar.org/) for the data and the -->
<!-- [steepness.R](https://github.com/npct/pct/blob/master/loading-data/steepness.R) -->
<!-- file in the project's repository for the processing algorithm used. "Version 4" -->
<!-- of the dataset was used. To allocate this area-based hilliness metric to OD -->
<!-- pairs, we calculated the average hilliness of origin and destination zones. This -->
<!-- method has the disadvantage that accuracy decreases with increased trip -->
<!-- distance.] -->

<!-- We used the Census 2011 travel to work origin-destination dataset for its comprehensive coverage of -->
<!-- the population, high geographic resolution and assurances surrounding data -->
<!-- quality. The MSOA It is worth noting that -->
<!-- a variety of emerging sources could be used instead to -->
<!-- provide OD data. This includes 'Big Data' -->
<!-- [@kitchin_big_2013] sources such as: mobile -->
<!-- telephone service providers [@smoreda_spatiotemporal_2013]; -->
<!-- public transport data, which can highlights local demand short trips; -->
<!-- household travel surveys [@transport_for_nsw_household_2014] -->
<!-- and output from transport demand models controlled by local government. -->

```{r, echo=FALSE}
# In practice using multiple datasets may be the most appropriate option.
# Individual and areal data can, for example, be combined using spatial
# microsimulation, allowing transport policies to be modelled at the
# individual level [@lovelace_spatial_2014].
# Even when travel surveys contains geographical information,
# sample sizes are generally comparatively small, less than 1% of the population,
# making them inappropriate as the sole source of input data for
# geographical modelling at the local level.
# Flows inferred from mobile phones are a promising new dataset for inferring
# travel behaviour. Recent
# work has been able to accurately reconstruct travel flow patterns from millions
# of anonymous users, including inference of purpose of travel [@alexander_validation_2015].
# If origin-destination flow estimates resulting from such datasets
# become more widely available to researchers, this could constitute one of the
# most single most valuable data sources for transport planners worldwide.
```

## Scenarios of cycling uptake 

Four scenarios were developed to
explore cycling futures in England.
These can be framed in terms of the removal of different infrastructural, cultural and technological barriers that currently prevent cycling being the natural mode of choice for trips of short to medium distances. 
They are not predictions of the future.
They are snapshots indicating how the spatial distribution
of cycling may shift as cycling grows based on current travel patterns.
At a national level, the first two could be seen as shorter-term and the 
second two more ambitious.
The choice of scenarios was informed by a government target to double the number of cycle trips
and evidence from overseas
about which trips *could* be made by cycling.
Summaries of the four scenarios are as follows (see the Appendix for full details):

- Government Target. This scenario represents a doubling of the level of of cycling in England [@department_for_transport_cycling_2014]. Although substantial in relative terms, the rate of cycling under this scenario (rising from 3% to 6% of commuters) remains low compared with countries such as the Netherlands and Denmark. Growth in cycling is not uniform in this scenario, in either absolute or relative terms. Areas with many short, flat trips and a below-average current rate of cycling are projected to more than double. Conversely, areas with above-average levels of cycling and many long-distance hilly commuter routes will experience less than a doubling. Government Target thus represents a slight reduction (but not elimination) of local barriers to cycling. This scenario may be useful for indicating where investment might have the greatest short-term impact.

- Gender Equality. This scenario illustrates the increase in cycling
that would result if women were as likely as men to cycle a given trip.
Specifically, the scenario sets the proportion of female cycle commuters to be equal
to the current proportion of males in each OD pair.
The scenario is based on the observation that in places where cycling accounts for a high proportion of personal travel,
women cycle at least as much as men [@pucher_infrastructure_2010;@aldred_does_2016].
This scenario has the greatest relative impact in areas where
the rate of cycling is highly gender-unequal.
<!-- In absolute terms, cycling increases most in this scenario where cycling -->
<!-- is already a common mode of transport. -->

- Go Dutch.
While the Government Target and Gender equality scenarios model relatively modest increases in cycle commuting, Go Dutch represents what would happen if English people were as likely as Dutch people to cycle a trip of a given distance and level of hilliness. This scenario captures the proportion of commuters that would be expected to cycle if all areas of England had the same infrastructure  and cycling culture as the Netherlands (but retained their hilliness and commute distance patterns). As such, whereas the Government Target and Gender Equality scenarios take current levels as a starting point, the predicted levels of cycle use in Go Dutch are unrelated to current levels, and are constrained only by local trip distance distributions and hilliness.


<!-- While Government Target and Gender Equality build on current cycling behaviour, -->
<!-- 'Go Dutch' focuses on long-term potential. -->
<!-- Go Dutch represents what would happen if English people were as likely as Dutch people to cycle a trip of a given distance and level of hilliness. -->
<!-- It works by assigning Dutch -->
<!-- distance decay parameters to English travel patterns. -->
<!-- The scenario represents the elimination of the -->
<!-- infrastructural and cultural constraints which currently hold back cycle -->
<!-- use in England, including all localised differences. -->
<!-- As such, whereas the Government Target and Gender Equality scenarios take current levels as a starting point, the predicted levels of cycle use in  Go Dutch -->
<!-- are unrelated to current levels, and are constrained -->
<!-- only by local trip distance distributions and hilliness. -->

- Ebikes. This scenario models the additional increase
in cycle use that would be achieved through the widespread uptake of electric
cycles.
Electric assist cycles enable longer journeys and reduce the barrier of hills.
This scenario is currently implemented as an extension Go Dutch
but could be implemented as an add-on for other scenarios.

Additional scenarios could be developed (see Discussion). If deployed in other settings, the PCT will likely benefit from scenarios that relate to both the current policy context and long-term aspirations.
OD data must be available for scenarios to be generated in new places, however, for health and other impacts to be related to transport infrastructure at high geographical resolution.

## Estimation of health and carbon impacts

The World Health Organisation’s Health Economic Assessment Tool ([HEAT](http://www.heatwalkingcycling.org/)) was used to estimate the number of premature deaths avoided due to increased physical activity [@kahlmeier_health_2014]. To allow for the fact that cycling would in some cases replace walking, HEAT estimates of the increase in premature deaths to the reduction in walking were also included (see the Appendix).
To model the change in walking, we assumed that within a given OD pair all modes were equally likely to be replaced by cycling.  Thus all the non-cycling modes shown in Table 2 experienced the same relative decrease.

Trip duration was estimated as a function of the 'fast' route distance and average speed. For walking and cycling we applied the standard HEAT approach. Ebikes are not specifically covered in HEAT Cycling but enable faster travel and require less energy from the rider than traditional bikes. Thus we estimated new speeds and intensity values for this mode, giving a smaller benefit for every minute spent using Ebikes than conventional cycles. For more details see the Appendix.

The risk of death varies by gender and increases rapidly with age.
This was accounted for using age and sex-specific mortality rates for each local authority in England.
The assumed age and sex profile of new cyclists also varied between scenarios (see Appendix).
The net change in the number of deaths avoided for each OD pair was equal to the number deaths avoided due to cycle commuting minus the number of additional deaths due to reduced walking.  Note that this approach means that in some OD pairs where walking made up a high proportion of trips, additional deaths were incurred.  The monetary value of the mortality impact was calculated by drawing on the standard 'value of a statistical life' used by the Department for Transport.

We also estimated the reduction in transport carbon emissions resulting from decreased car driving in each scenario.  This again relied on the assumption that, within a given OD pair all modes, were equally likely to be replaced by cycling.  The average CO^2^-equivalent emission per kilometre of car driving was taken as 0.186 kg, the 2015 value of an 'average' car [@defra_defra_2015].

## Visualisation, route allocation and network generation

The data analysis and preparation stages described in the previous sections were conducted using the national OD dataset for England as a whole.  By contrast, the stages described in this section (route allocation and visualisation) were conducted using a region-by-region approach. The regional focus was selected because transport decisions tend to be made at the local level [@gaffron_implementation_2003].
The regional approach also reduced the computational
requirements of the data generation process.

<!-- This increased the scalability of the PCT, allowing nationwide data to be generated on -->
<!-- desktop computers, albeit with large (16 GB+) amounts of RAM. -->

Figure 3 shows a visualisation of the output, straight lines with attributes for each OD pair aggregated
in both directions. 
These represent cycling 'desire lines' [@tobler_experiments_1987;@chan_multi-criteria_2003].
The visualisation of the OD data builds
on published work on cartographic visualisation [@rae_spatial_2009;@wood_visualisation_2010].

```{r, echo=FALSE, fig.cap="Overview of the PCT map interface, showing area and OD-level data. The zone colour represents the number of residents who cycle to work. The lines represent the top 6 most cycled commuter routes in Leeds, with width proportional to the total number of cycle trips. Population-weighted centroids are represented by circles, the diameter of which is proportional to the rate of within-zone cycling."}
# data("flowlines")
# plot(flowlines, lwd = flowlines$All / 10)
knitr::include_graphics("od-data-leeds.png")
```

<!-- A potential limitation of this single regional geographic level is -->
<!-- that 'edge zones', straddling two -->
<!-- or more regions, can become marginalised. -->
<!-- To overcome this issue the 'build' scripts were written to -->
<!-- enable custom regions. London, for example, -->
<!-- was 'built' at 2 different levels, one covering the entirety of the city -->
<!-- and another which divided the city into 4 quadrants based on a zoning system -->
<!-- used by Transport for London -->
<!-- (see [pct.bike/london/](http://pct.bike/london/) and -->
<!-- [pct.bike/london-east/](http://pct.bike/london-east/) respectively) -->
<!-- Another solution to the issue of edge-zones that was tested -->
<!-- (but not implemented following user feedback) -->
<!-- was the creation of buffers around the regions. -->
<!-- This involves expanding the outline of a region, -->
<!-- creating an area of overlap between two regions that are side-by-side. -->


```{r, echo=FALSE}
# The wider national policy context should be considered when selecting
# the regional geographies that are appropriate for the model.
# In Phase I of the work to implement the PCT for the UK we used LADs, then switched to CUAs after user testing.  TTWs also possible, and in the long term perhaps LEPS.  Our recommendation is to build it at the CUA level
```

```{r, echo=FALSE}
# ^[Highway
# Authorities and LADs will coincide in places where there are ‘unitary authorities’ (e.g. in England’s large conurbations, and the whole of Scotland and Wales). However in many parts of rural England, the Highway Authority will cover several District Authority areas. in any event though, the regions used as the building blocks of the PCT can adapt to reflect either, or alternative, funding structures (e.g. England’s Combined Authorities or Local Enterprise Partnerships
# (LEPs)).
# ]

# As well as CUA level an increasing proportion of transport funding in
# England is also being allocated to Local Enterprise Partnerships (LEPs)
# and Combined Authorities (CAs) which are larger than, and often overlapping with, CUAs.
# Based on these insights, and feedback from practitioners, our
# recommendation for Phase II is to build the PCT for every CUA in
# the nation and for selected LEPs and CAs where strategic
# cycling plans are being planned. These suggestions may change based on
# feedback from the Department for Transport.
#
# We will also explore the possibility of
# running the model at the national level. This would involve setting
# appropriate selection criteria to filter-out the majority of
# origin-destination pairs to avoid exceeding computational resources.
# The demarcation of regional boundaries is deemed useful for focusing
# on one region at a time.
#
# Phase I of the PCT project focused instead on smaller administrative units:
# Local Authority Districts (LADs). There are 324 LADs across England.
# For the case study towns of Manchester and Coventry, the choice between
# CUA and LAD levels
# made no difference as LADs and CUAs have the same boundaries for these areas.
# For Norwich, however, the LAD is much smaller than the CUA and is less
# practical for strategic transport planning at the MSOA level (Fig. 2).
# For this reason
# we implemented a buffer selection methodology to expand the scope of the
# selection, as described in the next section. Before describing the
# buffer selection method, it is worth briefly considering some
# of the other regional geographies that could be used: Travel to Work Areas (TTWAs),
# which could be applicable in many contexts and Local Enterprise Partnerships
# (LEPs) which are specific to the UK context.
#
# TTWAs are 'commuting watersheds' that correspond to
# cohesive regions, the centres of which are known employment centres [@Coombes2008].
# Versions of the PCT model developed for more scientific purposes would benefit
# from using TTWAs as the regional geography for local scenario development and
# visualisation.
```

```{r cuas-lads, eval=FALSE, echo=FALSE, fig.cap="The front page of the Propensity to Cycle Tool for England, showing the regional units used load and visualise the data. The tool itself initiates when one of the regions (such as West Yorkshire, shown) is selected."}
knitr::include_graphics("pct-frontpage.png")
```

<!-- ## Route allocation and network generation -->

Desire lines allocated to the route network are illustrated in Figure 4.
This shows two route options: the 'fast' route,
which represents an estimate of the route taken by cyclists to minimise travel time
and the 'quiet' route that preferentially selects smaller, quieter roads and
off road paths.

<!-- Overlapping fast routes were aggregated to create the 'Route Network' layer (see Figure 5). -->
<!-- These stages were computationally intensive, leading to a number of steps -->
<!-- being taken to make them fast and scalable: -->

```{r, echo=FALSE, fig.cap="Illustration of desire lines shown in Figure 3 after they have been allocated to the road network by CycleStreets.net. Purple lines are the 'fast' routes and turquoise routes were the 'quiet' routes."}
knitr::include_graphics("od-data-fast-quiet.png")
```

Routes generated by CycleStreets.net
do not necessarily represent the paths that cyclists currently take;
route choice models based on GPS data
have been developed for this purpose [@broach_where_2012;@ehrgott_bi-objective_2012].
Of the available routes provided by CycleStreets.net ('quietest', 'balanced' and 'fastest';
see [cyclestreets.net/journey/help](https://www.cyclestreets.net/journey/help/howtouse/) for more information), the 'fastest' option was used.
This option was chosen because when designing infrastructure, planners should consider
cyclists' preference for direct routes [@crow_design_2007]
and that cycling potential falls quickly with increasing distance.

<!-- To generate the Route Network layer, overlapping fast routes were aggregated (see Figure 5). These stages were computationally intensive, leading to a number of steps being taken to make them fast and scalable: -->

<!-- - Adjustable selection criteria were used to sample the lines before route allocation. Parameter setting the Euclidean distance and minimum all-mode number of commutes were set for each build. -->
<!-- Note that only between-zone (interzonal) commutes were represented on the route network due to the difficulty of estimating the route taken for a trip that starts and ends in the same zone. -->
<!-- Similarly those with no fixed commute were included in area-level data but not in flow-level data. -->

<!-- After some experimentation, these were set to 15 km and more than 10 commuters. -->
<!-- ^[To illustrate the effectiveness of these selection criteria, -->
<!-- consider the example of Manchester. Setting `mflow` to 30 reduced the number of OD pairs by 85%, yet -->
<!-- still accounted for almost 70% of commuters. -->
<!-- Different values for were tested to reach a reasonable -->
<!-- balance between comprehensive coverage and speed; we settled on `mflow = 10` -->
<!-- for the national build outside London although we plan to test reducing this further. -->
<!-- We also experimented by reducing `mdist` and settled on -->
<!-- 15 km. This translates to around 20 km -->
<!-- on the route network assuming a *circuity* value of 1.3, as reported by -->
<!-- [@cole_quantitative_1968]. -->
<!-- Only 1.4% of cycle commutes recorded in the -->
<!-- National Travel Survey exceeded a distance of 20 km.] -->

<!-- - Pre-processing of route-allocated lines. This meant that CycleStreets.net was not called for every build. -->
<!-- Instead, a pre-generated file of downloaded routes was used. -->

<!-- - Parallel code. We used the R package **foreach**  to make the slowest process in the build script run on multiple computer cores. -->
<!-- This roughly halved the build times. -->

<!-- To reduce data processing and visualisation times -->
<!-- a sub-sample of OD pairs was used. -->
<!-- The aim was to reduce the number of OD pairs whilst retaining the overall -->
<!-- travel pattern. To do this a minimum number (labelled `mflow`) -->
<!-- of trips between OD pairs was specified. OD pairs with less than -->
<!-- `mflow` trips were removed from the analysis. -->
<!-- This decision was taken on the basis that the distribution of number of commuters per OD pair is skewed: -->
<!-- a relatively small number of OD pairs along major travel corridors -->
<!-- account for a disproportionately high proportion of travel. -->

The spatial distribution of cycling potential can be explored interactively by selecting the 'top n' routes with the highest estimated cycling demand.
Information about the *aggregate cycling potential* on the road network is shown in the Route Network layer.
Because the layer is the result of aggregating overlapping 'fast' routes, and summing the level of cycling for each scenario (see Figure 5), it relates to the *capacity* that infrastructure may need to handle.
Cycling along Otley Road, under the Go Dutch scenario, rises from 73 to 296
along a single route, but from 301 to 1133 in the Route Network.
Note that more confidence can be placed in the relative rather than the absolute size of these numbers: the Route Network layer excludes within-zone commuters, commuters with no fixed workplace, and commuters working in a different PCT region
because because the PCT does not represent these on the travel network (see Figure 1). Route Network values also omit routes omited due to the adjustable selection criteria: maximum distance and minimum total numbers of all-mode commuters per OD pair. At the time of writing these were set to 20 km Euclidean distance and 10 commuters respectively.
This means that routes longer than 20 km or with ten or fewer commuters were omited.
Nationally, the Route Network layer under these settings accounts for around two thirds of cycle commuters.

<!-- The Route Network was generated with the R function `overline` [@lovelace_stplanr:_2016]. -->

<!-- ^[Thanks to Barry Rowlingson from the University of Lancaster for assistance developing this function.] -->

```{r, echo=FALSE, out.width = '50%', fig.cap="Illustration of route-allocated OD data (left) compared with route network data (right) which was produced by aggregating all overlapping route-aggregated OD pairs, using the 'overline' function from the stplanr R package.", fig.show='hold'}
knitr::include_graphics(c("fastest-headingly.png", "fastest-net-headingly.png"))
```

<!-- # Scenarios -->

<!-- The scenarios presented in the PCT operate at the OD level: -->
<!-- change in the rate of cycling is estimated per desire line, and subsequently aggregated up to the level of areas -->
<!-- and, via steps outlined above, down to the Route Network level. -->
<!-- A wide range of models could be used to estimate cycling potential at this level and scenarios are constrained only by the imagination (as considered in the Discussion). -->
<!-- This section outlines the scenarios produced for the English version of the PCT. -->


<!-- This section deliberately avoids technical detail about -->
<!-- the functional form of the model and how model parameters -->
<!-- for each scenario were derived (see the Appendix for this technical information). -->
<!-- Instead, it provides a high-level overview of the scenarios and how they were developed, which should be of use to others developing alternative cycling scenarios to inform the transport planning process. -->

<!-- For all scenarios except *gender equality*, a regression model was used -->
<!-- to estimate the potential rate of cycling at the OD level. -->
<!-- The parameters were estimated using trips level data from the National Travel Survey -->
<!-- using a logistic regression model estimating the *dependent variable*, -->
<!-- the probability of a trip being made by cycling $pcycle$, based on -->
<!-- distance ($d$) and hilliness ($H$) -->
<!-- For aggregate data, this translates into the proportion of trips made by cycling. -->

<!-- It is well-known that the proportion of trips made by cycle (henceforth -->
<!-- $pcycle$) tends to decrease with increasing distance [@iacono_access_2008]. -->
<!-- Based on this work and exploratory analysis of the data we estimated -->
<!-- the $logit$ of $pcycle$ rather than $pcycle$ directly. -->
<!-- The logit function converts a logistic curve for values between 0 and 1 (typically a probability, $p$) -->
<!-- into a linear curve via the relation: -->

<!-- (@) $$ logit(p) = log(\frac{p}{1 - p}) $$ -->

<!-- Preliminary analysis found $h$ to have a linear relationship with $pcycle$, -->
<!-- and interaction with distance, such that routes that were both hilly and -->
<!-- length were disproportionately unlikely to be cycled, -->
<!-- based on data from the National Travel Survey (see Appendix). -->

<!-- After an iterative process of model testing, the formula chosen was: -->

<!-- (@) $$ logit(pcycle) = \alpha + \beta_1 d + \beta_2 d^{0.5} + \beta_3 d^2 + \gamma h + \delta_1 d h + \delta_2 d^{0.5} h $$ -->

```{r, echo=FALSE}
# {#eq:description}
```

<!-- where $d$ is distance (km, route distance between population weighted centroids) and -->
<!-- $h$ is the hilliness -->
<!-- per OD pair. The remaining values are scalar -->
<!-- coefficients to be estimated. -->
<!-- $\alpha$ represents the intercept (the rate of cycling very short -->
<!-- trips). $\beta_1$, $\beta_2$ and $\beta_3$ represent the rate of distance decay. -->
<!-- $\gamma$ represents the impact of hilliness on cycling and the $\delta$ coefficients represent -->
<!-- the interaction between distance and hilliness (see Appendix). -->

<!-- ## Zone Buffer -->

<!-- Running the PCT region-by-region means -->
<!-- ignoring all zones outside the region. If the region is a -->
<!-- self-contained transport system this makes sense. -->
<!-- If the region is part -->
<!-- of a larger travel network, however, this could be problematic. -->
<!-- To solve this problem, buffers were used to expand regions -->
<!-- deemed to be part of a wider system.^[Various criteria were considered -->
<!-- to decide whether or not a buffer was needed and to select the size of the -->
<!-- buffer, for example -->
<!-- whenever the number of MSOA zones fell below some threshold -->
<!-- and the amount of inter-region travel. Ultimately it was decided to -->
<!-- add buffers on an ad-hoc basis, where they were deemed necessary.] -->
<!-- To illustrate how the buffers worked, -->
<!-- buffer was used to select zones -->
<!-- outside the City of Manchester (see Fig. 7 below). -->
<!-- This protocol increased the sample size by including all -->
<!-- zones whose population-weighted centroid lies inside the -->
<!-- buffer, the width of which can also be set based on knowledge of -->
<!-- the local area.i -->

<!-- These scenarios are described more fully below. -->

<!-- ## Government Target -->

<!-- The Government Target scenario -->
<!-- is based on the UK government's proposed target -->
<!-- (as set out in its draft Cycling Delivery Plan [@department_for_transport_cycling_2014]) -->
<!-- to double cycling in England, from 0.8 billion stages currently to 1.6 billion stages by 2025. -->
<!-- However @department_for_transport_cycling_2014 says nothing about where these additional -->
<!-- trips would come from. The Government Target scenario is therefore based on our own -->
<!-- assumptions about this. It aims to assist transport -->
<!-- planners in identifying where new demand for cycling is likely to be greatest in -->
<!-- the near term. -->

<!-- The key point about this scenario is that cycling does not double in all -->
<!-- areas. Instead, the increase is related to the current -->
<!-- commuter trips and the trip distance. -->

<!-- At the heart of the Government Target scenario is the previously discussed -->
<!-- regression model (labelled $natmod$) estimating -->
<!-- the dependent variable, namely the percentage of commuters who cycle (*pcycle*). -->
<!-- The new percentage of commuters who cycle ($pcycle(govtarget)$) -->
<!-- for each desire line is calculated as the current rate of -->
<!-- cycling plus this model-based estimate: -->

<!-- (@) $$ pcycle(govtarget)_{ij} = (pcycle_{ij} + pcycle(natmod)_d) $$ -->

<!-- where $pcycle_{ij}$ is the 2011 Census proportion of commuters who cycle for an OD pair $ij$ -->
<!-- of distance $d$ apart and $pcycle(natmod)_d$ is the proportion of commuters expected to -->
<!-- cycle the distance $d$ based on the national-level regression model. -->
<!-- The sum of these values -->
<!-- can be multiplied by the total number of commuters for all modes $tflow_{ij}$ -->
<!-- to convert the proportion into a number of cyclists, i.e.: -->

<!-- (@) $$ SLC(govtarget)_{ij} = (pcycle_{ij} + pcycle(natmod)_d) * tflow_{ij} $$ -->

<!-- where $SLC(govtarget)_{ij}$ is the *Scenario-based Level of Cycling* for this scenario for the $ij$ OD pair. -->
<!-- An example of this scenario for an imaginary OD pair $ab$ with Euclidean -->
<!-- distance 4.5 km is as follows. -->
<!-- In a representative sample of OD pairs in the UK -->
<!-- of distance 4-5km, the average proportion of cycle commuters was 5%. -->
<!-- Under the 'national doubling', -->
<!-- assume an additional 5% of commuters now cycle for all -->
<!-- trips of 4.5km --- i.e. $pcycle(natmod)_{4.5} = 0.05$. -->
<!-- For our specific OD pair $ab$ in the Census there are -->
<!-- 200 commuters, of whom only 2 are cyclists ($pcycle_{ab} = 0.01$). -->
<!-- The scenario adds an additional 5% of commuters, i.e. an additional 10 cyclists which more than doubles the total number of cyclists from 2 to 12. -->
<!-- The same methodology is applied to all distances represented in the OD -->
<!-- matrix.^[Thus -->
<!-- this particular OD pair has gone from a current proportion of cyclists to 1% (five times lower than the national average of 5%) to having a scenario proportion of cyclists of 6% (just over half the national average of 10%).  This illustrates the point that this scenario tends to equalize, but does not remove, pre-existing differences in cycling levels. -->
<!-- ] -->

<!-- The approach assumes that cycling potential against a given national -->
<!-- increase is always a positive number. -->
<!-- When only modest increases in cycling are assumed -->
<!-- (e.g. from 3% to 6% as an overall mode share), -->
<!-- the pre-existing cycling demographic contributes considerably to the new demographic. -->
<!-- In more ambitious cycling scenarios the pre-existing distribution matters less. -->
<!-- This corresponds to the insight that, with sustained investment in overcoming the infrastructural and -->
<!-- cultural constraints which limit cycle use, -->
<!-- the long-term potential becomes more important -->
<!-- than the current rate of cycling. -->

<!-- ## Gender equality -->

<!-- The next scenario to be discussed is Gender Equality. In this -->
<!-- scenario cycling tends to grow more in areas that already have a high -->
<!-- rate of cycling. The scenario -->
<!-- recognises that this disparity is reduced or absent in -->
<!-- countries with a high rate of cycling [@Fishman2015]. -->
<!-- The Gender Equality scenario builds on such insights -->
<!-- and is based *observed level of cycling* (*OLC*) from the 2011 Census. -->

<!-- On average in England around three quarters of cycle commuters -->
<!-- are male, although this varies geographically [@Aldred2015]. -->
<!-- Gender Equality assumes that gender equality is reached in cycling. -->
<!-- A prerequisite is a model-based estimate of the number of male -->
<!-- and female cyclists between origin and destinations for -->
<!-- the observed data. -->
<!-- This involves splitting the number of cyclists estimated by the model, -->
<!-- the *Scenario-based Level of Cycling*, into -->
<!-- male ($SLC(gendereq)_m$) and female ($SLC(gendereq)_f$) components: -->

<!-- (@) $$ SLC(gendereq) = SLC(gendereq)_m + SLC(gendereq)_f $$ -->

<!-- More males cycle to work than females in every Local Authority in England -->
<!-- (Fig. 4). For this reason, the Gender Equality scenario -->
<!-- is based on the assumption that the rate of cycling amongst -->
<!-- females increases to match the rate of cycling amongst males. -->
<!-- Under Gender Equality $SLC(gendereq)_m = OLC_m$, there are no additional male cyclists. -->
<!-- Note that this is not as simple as $SLC(gendereq)_f = SLC(gendereq)_m$, -->
<!-- as the absolute number of female and male cyclists will also depend on the gender split of the total commuting population within each OD pair.^[To -->
<!-- illustrate this point, consider an OD pair in which the total number of female -->
<!-- commuters is larger than the total number of male commuters. -->
<!-- In this case, the number of female cyclists would exceed the -->
<!-- number of male cyclists in the Gender Equality scenario. -->
<!-- ] -->
<!-- It is the *proportion* of males and females -->
<!-- per OD pair who cycle that becomes equal, as follows. -->

<!-- (@) $$ pcycle(gendereq)_f = pcycle_{m}$$ -->

<!-- (@) $$ \frac{SLC(gendereq)_f}{tflow_f} = \frac{OLC_m}{tflow_m} $$ -->

<!-- (@) $$ SLC(gendereq)_f = tflow_f * \frac{OLC_m}{tflow_m}$$ -->

<!-- $OLC_m$ is the observed number of male cycle commuters -->
<!-- (in the 2011 Census in this case), -->
<!-- $SLC(gendereq)_f$ is number of female cycle commuters in the gender equality scenario, and -->
<!-- $tflow_m$ and $tflow_f$ are the total numbers of males -->
<!-- and females in the OD pair respectively. -->

<!-- $tflow_m$ and $tflow_f$  are both available at the OD level in the 2011 Census, -->
<!-- as is the total number of cyclists ($OLC$).  The proportion of cyclists who are male -->
<!-- in each OD pair ($pmale_(cyclist)$) is not available in the published 2011 datasets. -->
<!-- The smallest level at which the gender breakdown of cyclists is currently available -->
<!-- is the zone level ('$pmale_{cyclist}(zone)$'), and we assume that all OD pairs have -->
<!-- this same proportion of male cyclists. This allows the estimation -->
<!-- the number of male cycle commuters as $OLC_m = OLC * pmale_{cyclist}(zone)$, so that -->

<!-- (@) $$ SLC(gendereq)_f = OLC * pmale_{cyclist}(zone) *  \frac{tflow_f}{tflow_m} $$ -->

<!-- and therefore the total number of trips for gender equality $SLC(gendereq)$ would be -->

<!-- (@) $$ SLC(gendereq) = OLC_m + SLC(gendereq)_f $$ -->

<!-- (@) $$ SLC(gendereq) = OLC * pmale_{cyclist}(zone) * (1 + \frac{tflow_f}{tflow_m}) $$ -->

<!-- ```{r, echo=FALSE, fig.cap="Cycling and the gender balance of cycling in England. The choropleth maps illustrate the spatial distribution of the two variables. The scatter plot illustrates the relationship between the two variables cycle commuting (x axis) against the proportion of commuter cyclists who are male (y axis) for all 326 Local Authorities (including Districts) in the UK."} -->
<!-- grid.raster(readPNG("../figures/las-gender-pcycle.png")) -->
<!-- ``` -->

<!-- To illustrate how this method works in practice, imagine an OD pair in which -->
<!-- 50 from a total of 500 people commute by cycle ($tflow = 500; OLC = 50$). -->
<!-- 300 of the total trips in the OD pair are made by males -->
<!-- ($tflow_m = 300$) and 200 by females ($tflow_f = 200$). -->
<!-- In addition, 70% of commuter cycling in the wider zone is by -->
<!-- males ($pmale_{cyclist}(zone) = 0.70$). This means that -->
<!-- an estimated $50 * 0.70 = 35$ cycle commuters are male ($OLC_m = 35$) and -->
<!-- 15 are female ($OLC_f = 15$). -->

<!-- Applying the formulae presented previously: -->

<!-- (@) $$ SLC(gendereq)_f = OLC * pmale_{cyclists}(zone) * (1 + \frac{tflow_f}{tflow_m}) $$ -->

<!-- (@) $$ SLC(gendereq) = 50 * 0.70 * (1 + \frac{200}{300} ) = 58.3 $$ -->

<!-- ```{r, echo=FALSE} -->
<!-- tflow <- 500 -->
<!-- olc <- 50 #  the currect rate of cycling between origin (o) and destination (d) -->
<!-- tflow_m <- 0.6 # the proportion of all trips o and d by males -->
<!-- pcyclez_m <- 0.75 # the proportion of cycle trips in the zone/region made by males -->
<!-- tflow_m <- tflow * tflow_m -->
<!-- tflow_f <- tflow * (1 - tflow_m) -->
<!-- olc_m <- olc * pcyclez_m -->
<!-- olc_f <- olc - olc_m -->
<!-- pmale_c <- olc_m / tflow_m -->
<!-- slc_gendereq_f <- tflow_f * pmale_c -->
<!-- # print(olc_f) -->
<!-- # print(slc_gendereq_f) -->
<!-- ``` -->

<!-- The increase from 50 cyclists to 58.3 represents an increase -->
<!-- of 17% from the observed rate of cycling -->
<!-- in total numbers of cyclists.  All of these extra 8.3 -->
<!-- cyclists are female, giving a new total of 15 + 8.3 = 23.3 female cyclists -->
<!-- (and still 35 male cyclists). -->
<!-- Gender equality in cycling has been reached, such that an estimated 11.7% -->
<!-- of commute trips are made by cycling among both men (35/300) -->
<!-- and women (23.3 / 200). -->

<!-- ## Go Dutch -->

<!-- The 'Go Dutch' scenario represents the rate of cycling that would occur -->
<!-- if people had the same propensity to cycle as the Dutch do, for trips of -->
<!-- the same length and hilliness. It is -->
<!-- important to note that this is not a 'top down' scenario in which the national -->
<!-- level of cycling is set to levels found in The Netherlands. The scenario is -->
<!-- 'bottom up' because the proportion of trips being cycled is set per OD pair -->
<!-- and the end result for any particular region depends on the local distribution -->
<!-- of trip distances. -->
<!-- Although the Dutch currently cycle far more frequently than the -->
<!-- English for short trips, their propensity to cycle still drops rapidly with -->
<!-- distance, with relatively few utility trips being made beyond around 15 km. -->

<!-- Based on these insights, the essence of the 'Go Dutch' scenario -->
<!-- is the application of distance decay parameters -->
<!-- found in the Netherlands to each OD pair in the study area. -->

<!-- In contrast to Government Target and Gender Equality scenarios, -->
<!-- Go Dutch is unrelated to the current rate of cycling. The scenario -->
<!-- thus represents the elimination of localised -->
<!-- constraints which inhibit cycle use more in some area than others. -->
<!-- Local cycle use in Go Dutch is therefore constrained -->
<!-- only by trip distances and hilliness. -->

<!-- ## E-bikes -->

<!-- This scenario aims to provide insight into how cycling -->
<!-- could shift with the uptake of electric cycles ('E-bikes'). -->
<!-- The scenario builds on 'Go Dutch' and represents -->
<!-- a reduction in the degree to which cycle use is -->
<!-- constrained by trip distances and technology. -->
<!-- This is the most ambitious and speculative -->
<!-- scenario presented in this paper. -->

<!-- The results are -->
<!-- based on the decision to increase by a small amount the $\beta_1$ distance decay parameter, -->
<!-- which corresponds to distance as a linear term. -->
<!-- Specifically, we increased this value by 0.025, as we found -->
<!-- this to be sufficiently small to avoid generating an -->
<!-- implausibly high rate of cycling but sufficiently large to create a noticeable effect. -->
<!-- This allows us to illustrate the type of output that will -->
<!-- be possible in this model. In future work we plan to -->
<!-- update this scenario, basing the changes to the distance decay -->
<!-- parameters on real data from the Dutch National Travel Survey. -->
<!-- This will build on analysis of the influence of E-bikes on propensity to cycle -->
<!-- in the Netherlands, research that is being undertaken in parallel to the work -->
<!-- presented in this paper. -->

# Outputs of the Propensity to Cycle Tool

This section describes and illustrates some outputs from the PCT, alongside discussion of how these outputs could be used in transport planning.  Note that some details of the graphics in the online version may evolve as the PCT develops.

## Model output tabs

Tabs are panels within the PCT that reveal new information when clicked (see the top of Figure 3). Of these, the first four provide region-specific information:

- **Map**: This interactive map is the main component of the PCT, and is the default tab presented to users. It shows cycling potential at area, desire-line, route and route network levels under different scenarios of the future, as described throughout this paper. 'Popups' appear when zones, desire lines or segments on the Route Network are clicked, presenting quantitative information about the selected element.

- **Lines**: When lines are displayed on the interactive map, this tab provides the raw data as a table at the OD pair level. Variables shown include the origin and destination zone of the route, current number of commutes by rail, bus, car and bicycle, the increase in cyclists under different scenarios, and geographical data such as straight line distance, hilliness and circuity.

- **Areas**: This tab is the equivalent of the 'Lines' tab, but with data at the area level.

- **Model output**: This tab includes key statistics, diagnostic plots and model-results on a per-region
basis. Since the contents of this tab are created based on the data for each regional 'build',
it produces a different summary document depending on
the region currently being viewed.
For each scenario it shows the distribution of cycling by trip distance (see Figure 6), and thereby provides insight into local travel patterns and how they relate to cycling potential in the region overall.

## Trip distance distributions

Figure 6 shows how the proportion of trips made by cycling varies as a function of distance in two regions currently, and under the PCT's four scenarios of change. Examining the distribution of commute trips by all modes (the red lines), it is clear that the two regions have different spatial structures. In Oxfordshire a high proportion of all commute trips are short (under 5km), which helps explain the high rate of cycling there. West Yorkshire, by contrast, has a higher proportion of trips of medium or longer lengths.  West Yorkshire also shows a less marked difference in the number of cyclists according to distance than Oxford, as indicated by the comparatively shallow curve for current cycling.

<!-- These results (presented in the Model Output tab in the PCT) suggest that there is high cycling potential in both regions but perhaps imply that West Yorkshire should prioritise the 'low hanging fruit' of short trips not currently cycled whereas in Oxfordshire extra cycling potential is more evenly distributed across all cyclable distances. -->

```{r, echo=FALSE, fig.cap="Trip frequency-distance distributions of observed and scenario-based levels of cycling from PCT model runs for the city of Manchester (left) and Norwich (right).", eval=FALSE}
# commented out as it's been superceded
knitr::include_graphics("man-nor-output-2.png")
```

```{r, echo=FALSE, out.width = '50%', fig.cap="Modal share of trips made by cycling for English commutes in West Yorkshire (left) and Oxfordshire (right) currently and under 4 scenarios of change.", fig.show='hold'}
knitr::include_graphics(c("../figures/dd-west-yorks.png", "../figures/dd-ox.png"))
```

Note that although West Yorkshire and Oxfordshire have very different initial levels of cycling,
the estimates under Go Dutch and Ebikes scenarios for each distance band are similar:
long-term scenarios are not influenced by the current rate of cycling.

<!-- In Manchester the Government Target scenario -->
<!-- has a considerably higher rate of cycling than the Gender Equality -->
<!-- scenario, whereas in Norwich these scenarios are very similar. This is because -->
<!-- Manchester is starting from a lower baseline, so a doubling nationwide -->
<!-- results in a relatively high absolute increase in cycling locally. In Norwich, -->
<!-- by contrast, the current rate of cycling is considerably greater than the -->
<!-- national average, so the Government Target scenario represents less than a doubling in -->
<!-- cycling. -->

## The shifting spatial distribution of cycling

The spatial distribution of cycling potential differs markedly between scenarios, as illustrated in Figure 7 for the city of Leeds, West Yorkshire. The top 6 OD pairs (a low number was used to focus on the city centre) in Leeds under Government Target are strongly influenced by the current distribution of cycling, which is focussed in the relatively wealthy North of the city (see Figure 3 for top 6 flows currently). Cycle commuting is projected to continue to be most common in the North the city. Under the Go Dutch scenario, by contrast, the pattern of cycling shifts substantially to the South.
The cycling patterns under the Go Dutch scenario
are more representative of short-distance trips across the city overall.
In both cases the desire lines are focused around Leeds city centre: the region
has a mono-centric regional economy, making commute trips beyond around 5 km from the
centre much less likely to be made by cycling.

```{r, echo=FALSE, fig.cap="Model output illustrating the top 6 most cycled OD pairs in Leeds under the Government Target and Go Dutch scenarios."}
knitr::include_graphics("od-scens-leeds.png")
```

<!-- The equivalent results are shown for the city of Manchester in Figure 8. This shows that -->
<!-- Manchester has a poly-centric structure, favouring the construction of cycle -->
<!-- routes between the various sub-centres, not just in radial routes to a single -->
<!-- centre. As shown in the scale bar up the left-hand side, -->
<!-- the absolute level of cycling is much lower in Government Target -->
<!-- (which represents only a doubling nationwide) -->
<!-- than in the much more ambitious Go Dutch scenario. -->

The same scenario is illustrated in Figure 8 with the Route Network layer.
This shows how the shift in cycling to become more evenly spread across the city translates into estimates of cyclist flows on specific road segments.
The number of commuter cyclists expected on York Road, highlighted with a popup, more than triples (from 71 to 236)
under Government Target and increases more than 10 fold under Go Dutch (from 71 to 966).
This contrastswith Otley Road (highlighted in Figure 5), which 'only' triples under Go Dutch.
These results suggest that as cycling grows, policy interventions in Leeds should shift from routes in the Northwest of the city, the area with the highest current level of cycling, to routes that have low current rates of cycling but high potential, such as York Road to the East. Cycle paths built to help achieve ambitious targets, as represented by the Go Dutch scenario, should be of sufficient width to accommodate the estimated flows: the number of cycle commuters would be expected to increase more than ten-fold on York Road under this scenario and infrastructure design should adapt accordingly.

```{r, echo=FALSE, fig.cap="The Route Network layer illustrating the shifting spatial distribution of cycling flows in Leeds under Government Target (top) and Go Dutch (bottom) scenarios."}
knitr::include_graphics("leeds-rnet-gov-go.png")
```

Another potentially useful output is the difference between
'fast' and 'quiet' routes.
Figure 9 illustrates this by showing routes in Manchester with the highest cycling
potential under the Government Target scenario.
The 'quiet' route is substantially longer: 2.6 km
(as shown by clicking on the line). The 'fast'
route is more direct (with a route distance of 2.3 km) but passes
along Trinity Way (the A6042), a busy dual carriage way.
The Euclidean distance
associated with this OD pair is 1.6 km
(this can be seen by clicking on a line illustrated from the 'Straight Lines' layer inn the PCT's interface),
resulting in circuity values of
1.4 and 1.6 respectively. We refer to the difference between the 'fast'
and 'quiet' routes as the 'quietness diversion factor' ($qdf = 1.2$
in this case).

Dutch evidence suggests that cyclists are generally unwilling to
take a path that is more than around 1.3 to 1.5 times the length of the
'crow-flies' Euclidean distance (defined as $q$ above).
The same research suggests that circuity values for
"for cycle provision should be 1.2" [@crow_design_2007].
This suggests that high quality cycle infrastructure along the 'fast' route shown in Figure 9,
or a more direct route that does not adhere to the current transport infrastructure,
would be more attractive than an
alternative quiet route that diverges greatly from the shortest path.
Previous work indicates that this is likely particularly true for women and older people, for whom distance is a greater deterrent to cycling than for young men [@woodcock_national_2016, see Appendix 8].
Combined with their greater preference for segregated infrastructure reported by these groups, this highlights the importance of providing direct and safe routes to encourage cycling amongst groups who currently cycle the least.

```{r, echo=FALSE, fig.cap="Close-up of a 'fast' and 'quiet' route in the PCT under the Government Target scenario in Manchester. This provides an indication of the local 'quietness diversion factor'."}
knitr::include_graphics("man-trinity-way.png")
```

Figure 9 demonstrates
another feature of the PCT's interactive map: the ability to turn the transparency
of the colours representing the area level of cycling on or off, allowing users to
see the basemap more clearly.
Three basemaps are available on PCT, and choosing the appropriate one can show how latent demand for cycling relates to current cycle infrastructure (with the OpenCycleMap basemap), small-area deprivation (with the Indices of Multiple Deprivation 'IMD' layer) and road width for space re-allocation for cycle and walking paths (with the satellite basemap).

<!-- ## The Model Output tab -->


```{r, echo=FALSE, fig.cap="Sample content from the Model Output Tab of the Propensity to Cycle Tool", eval=FALSE}
# commented out for now as it's a weak figure
knitr::include_graphics("model-output.png")
```

# Discussion

We have outlined a method for modelling and visualising the spatial
distribution of cycling flows, currently and under various scenarios of 'cycling futures'.
Inspired by previous approaches to estimating cycling potential [@larsen_build_2013;@zhang_prioritizing_2014]
and by online, interactive planning support systems (PSS) [@pettit_online_2013], the
PCT tackles the important yet largely unresolved issue
of how to create a systematic evidence base to prioritise where to build new cycle paths
and identify areas to prioritise for localised interventions.
Illustrative uses of the PCT demonstrated the potential utility of the tool, for example
by showing settings in which the spatial distribution
of cycling demand is likely to shift as cycling grows. 

<!-- For example, the output of the PCT suggests that the 'centre of gravity' for cycling in the city of Leeds will shift towards areas with high numbers of short distance trips but low current rates of cycling. -->

In addition to creating an evidence base for planning specific routes and area-based interventions, the long-term Go Dutch and Ebikes scenarios could be used for 'visioning' transport futures [@tight_visions_2011;@hickman_transitions_2011].
The PCT could also: help translate national targets into local aspirations (as illustrated by the Government Target scenario); inform local targets (e.g. by indicating what the potential in one region is relative to neighbouring regions); support business cases (by showing that there is high cycling potential along proposed routes); and help plan for capacity increases in cycling along the route network via the network analysis layer.
Ongoing case study work with stakeholders will establish and develop these uses. 
Future developments will be facilitated by the open source code underlying the PCT (see [github.com/npct](https://github.com/npct)),
making it easy for others use the project as a basis for further work [@lima_coding_2014].


<!-- The underlying code is open source (see [github.com/npct](https://github.com/npct)), -->
<!-- making it easy for others use the project as a basis for further work [@lima_coding_2014]. -->
<!-- This flexibility -->
<!-- has been demonstrated by the tool's ability to be deployed in any -->
<!-- Local Authority (or other administrative area) -->
<!-- in England. -->
<!-- <!-- Extensibility has been demonstrated by the addition of --> 
<!-- <!-- new scenarios, and the addition of new features to the tool following user feedback.  --> 

<!-- An indication of how the -->
<!-- tool could be used was illustrated -->
<!-- with maps showing the shifting distribution of cling -->
<!-- under 'Government Target' and 'Go Dutch'  -->
<!-- scenarios in Leeds and Manchester. These outputs suggested -->
<!-- the 'centre of gravity' for gravity will shift, towards areas with high -->
<!-- numbers of short distance trips (and therefore high latent demand) but -->
<!-- low current rates of cycling. -->
<!-- The scenarios suggest the PCT could be used for 'visioning' transport futures futures [@tight_visions_2011]. -->

<!-- Such developments could further enhance the PCT's ability to provide an evidence base to support local knowledge. -->
<!-- Future (more sophisticated) versions of the PCT could provide a visual evidence base to help answer the following question [see @Sloman2014; @Aldred2014]:   -->
<!-- Should cycling investment prioritise -->
<!-- areas of relatively low current propensity but high potential, or those of relatively -->
<!-- high current propensity but lower potential? -->

<!-- In the Netherlands (representing long-term ambition), -->
<!-- cycling is equally popular -->
<!-- among males and females and across -->
<!-- different socio-economic and age groups, -->
<!-- although some ethnic and religious differences exist [@Fishman2015]. -->
<!-- Demographics should therefore play less of a -->
<!-- role in estimating cycling potential for strategic purposes -->
<!-- than for identifying 'quick-win' policies based on current propensities. -->

<!-- Based on this understanding, the PCT has the potential to represent spatial -->
<!-- *and* demographic shifts in cycling as it grows. -->

<!-- An evaluation of the PCT *after* it has been launched (July 2016) and used by practitioners will be needed to assess the extent to which the approach assists transport-land use planners. -->
<!-- This will test our hypotheses that the tool can help translate national targets into local aspirations (as illustrated by the Government Target scenario), set local targets (by indicating what the potential is relative to other regions), -->
<!-- support business cases (by showing that there is high cycling potential along proposed routes) and plan -->
<!-- for capacity increases in cycling along the route network via the network analysis layer. -->
<!-- Above all, post-launch evaluation will be able to assess the extent to which the approach can -->
<!-- help design strategic cycling networks. -->

<!-- ^[Targets have proliferated in recent years. For instance, an official -->
<!-- target to reach 10% of trips made by bicycle has been -->
<!-- made by authorities in Dublin, Leicester and across -->
<!-- all of Scotland over various time-scales [@beatley_green_2012]. A mode share of -->
<!-- "20% by 2020" has been set for several cities including San Francisco and -->
<!-- Orlando.] -->


As with any modelling tool, the approach presented in this paper has
limitations: the reliance on Census OD data from 2011 means that the results are limited to commuting and may not encapsulate recent shifts in travel behaviour, and the user interface is constrained to a few, discrete, scenarios.
These limitations suggest directions for future work, including: use of new sources of OD data, and the implementation of continuous variables to define future scenarios.

<!-- ; and versions of the model to represent the impact of specific improvements to the route network (e.g. by modifying the 'quietness diversion factor'). Beyond these changes, further extensions of the PCT could include: -->

There is often a tension between transparency and complexity in the design of tools for transport planning. Excessive complexity can result in tools that are 'black boxes' [@saujot_making_2016].
In a context of limited time, expertise, and resources, Saujot et al. caution against investing
in ever more complex models.
Instead, they suggest models should be more user focussed.
The PCT’s open source, freely available nature will, we believe, facilitate the future development of the PCT organically to meet the needs of its various users.
For instance, we envision that stakeholders in local government modifying scenarios for their own purposes, and that academics in relevant fields may add new features and develop new use cases of the PCT. Such enhancements could include:

- Additional scenarios to illustrate a wider range of 'cycling futures', including medium-term and local targets such as 'Go York' (where 12% of commuters cycle to work).

- The extension of the model to cover variation between different demographic
groups. This could be done using spatial microsimulation, which
enables the use of additional individual-level variables,
such as access to a cycle and physical fitness,
to inform more targeted interventions [@lovelace_spatial_2014].

<!-- - The incorporation of changes in land-use and transport since the Census 2011, -->
<!-- to explore the dynamics of cycling potential, such as the impact of new residential and commercial developments. -->
<!-- This work could build on recently developed GIS for transport planning [@farrell_evaluating_2015]. -->

- Additional purposes of trips in the model. An 'education layer' would enable prioritisation of 'safe routes to school', building on methods analysing 'school commute' data [@singleton_gis_2014].
Other data sources to include more trip types include mobile telephone providers [@alexander_validation_2015] and traditional transport models.

- Deployment of the PCT for in new cities, regions or countries. This depends on the availability of appropriate OD data, perhaps from sources mentioned in the previous point.
Such work could also facilitate international comparisons of cycling potential.

Transport planning is a complex and contested field [@banister_sustainable_2008].
When it comes to sustainable mobility, policy, politics, leadership and vision are key ingredients that computer models alone cannot supply [@melia_urban_2015].
The approach described here can, however, assist in this wider context by providing new tools for exploring the evidence at high geographical resolution and envisioning transformational change in travel behaviours.

By providing transport authorities, campaign groups and the public with access to the same evidence base, we hypothesise that tools such as the PCT can encourage informed and rigorous debate, as advocated by @golub_making_2013. In conclusion, the PCT provides an accessible evidence base to inform the question of where to prioritise interventions for active travel and raises more fundamental questions about how models should be used in transport planning.

<!-- limitations: the reliance on 2011 Census OD data means that the results are -->
<!-- not up-to-date; -->
<!-- there are no scenarios representing specific infrastructure -->
<!-- interventions; and the user interface is constrained to a few discrete scenarios. -->
<!-- These limitations open-up the potential for future work, including: -->
<!-- using more up-to-date sources of OD data; creating a version of the model -->
<!-- to represent the impact of specific improvements to the route network -->
<!-- (e.g. by modifying the 'quietness diversion factor', described above); -->
<!-- and the implementation of continuous variables to define future scenarios. -->
<!-- Further extensions of the PCT  -->
<!-- could include: -->

<!-- - Additional scenarios to illustrate a wider range of 'cycling futures', including medium-term and local targets such as 'Go York' (where 12% of commuters cycle to work). -->

<!-- - Additional 'output tabs' in the PCT's user interface, to estimate the -->
<!-- quantitative benefits of cycling uptake at the local (and potentially -->
<!-- route-allocated) level. Benefits estimated could include -->
<!-- health gains due to increased physical activity, as estimated using models such as -->
<!-- the Health Economic Assessment Tool -->
<!-- (HEAT), endorsed by the World Health Organisation [@fraser_cycling_2011]. -->
<!-- The tool could also be used as a basis for estimating and communicating the local energy and -->
<!-- carbon savings of cycling uptake, previously estimated at city levels [e.g. @lovelace_assessing_2011]. -->

<!-- - Deployment of the PCT for entire countries. -->
<!-- This would depend on having appropriate OD data and could -->
<!-- build on emerging 'Big Data' sources for origin-destination -->
<!-- flows [@alexander_validation_2015]. -->

<!-- - International comparisons of cycling potential. -->
<!-- This could include an exploration of -->
<!-- the relationship between places of high potential and investment. -->
<!-- We have already begun this by using Dutch distance decay functions in an English -->
<!-- context, but more could be done by fully implementing the model in different -->
<!-- country contexts. -->

<!-- - Additional purposes of trips in the model. -->
<!-- An 'education layer' would enable prioritisation of 'safe routes to school', -->
<!-- building on methods analysing 'school commute' data [@singleton_gis_2014]. -->

<!-- - Use of alternative input data data, such as the location of new developments and road traffic speed and volumes. This work could build on recently developed GIS-based methods for transport planning [@farrell_evaluating_2015]. -->

<!-- The PCT's open source license allows others to -->
<!-- modify it for their own needs. , -->
<!-- to modify the scenarios, input data and display of the results to suit -->
<!-- local contexts. This could, for example, help to visualise city-level targets for -->
<!-- the proportion cycling by a certain year and -->
<!-- which will vary considerably from place to place in ways not yet well understood. -->
<!-- Modifying the code base would also allow transport planners -->
<!-- to decide on and create the precise set of online tools that are most useful for their work. -->
<!-- Building on participatory models at the macro-level [@Macmillan2014], extensions -->
<!-- to the model could include using the PCT methodology to -->
<!-- enable public engagement in the strategic planning process around -->
<!-- sustainable transport. -->

<!-- Transport planning is a -->
<!-- complex and contested field [@banister_sustainable_2008]. -->
<!-- Policy, politics, leadership and vision are key ingredients for sustainable -->
<!-- urban mobility that computer models alone cannot supply [@melia_urban_2015]. -->
<!-- The approach described here can assist in this wider context by providing -->
<!-- new tools for exploring the best available evidence. -->
<!-- By providing transport authorities, campaign groups and the public with access to the same evidence base, -->
<!-- we hypothesise that tools such as the PCT can encourage informed and rigorous debate, -->
<!-- as advocated by @golub_making_2013. -->
<!-- In conclusion, although the PCT aims to inform the specific issue of where to construct -->
<!-- new infrastructure for cycling, it relates to the wider -->
<!-- question of how to create an evidence-base for designing sustainable transport plans. -->

<!-- Moreover, by highlighting the importance of 'arterial' routes to key destinations, -->
<!-- the PCT can help rejuvenate long-standing debates -->
<!-- such as the re-allocation of road space away from -->
<!-- private cars [@Jones2014;@Sharples2009;@Black1992]. -->

```{r, echo=FALSE}
# However, we would argue that cycle path quality is not something
# that needs to be modelled at the meso-level in a tool such as the PCT. The
# tool's niche is strategic planning for cycling uptake: once areas, travel
# corridors and road segments have been prioritised by the PCT, it is up to
# local transport engineers to ensure that the quality of the new paths is sufficient.
# Further work in this direction could explore the impact of high levels
# of 'telecommuting', for example, based on Finnish data [@Helminen2007].
```

<!-- The flexibility of the approach outlined in this paper means that the -->
<!-- PCT can be seen not only as a tool but as a framework for strategic -->
<!-- transport planning. -->
<!-- Under this interpretation the case study of cycling in England is -->
<!-- just one of many potential applications. -->
<!-- Still, a number of the lessons learned throughout the -->
<!-- development and user testing of the tool are generalisable internationally. -->
<!-- Indeed, one of the major motivations for writing this paper is to showcase the method -->
<!-- for use by others to avoid 'reinventing the wheel' to help answer the common question of where to build. -->

```{r, echo=FALSE}
# Future work will focus on enabling practitioners to add
# new features to the PCT. This is based on the understanding
# that the people who best understand the
# requirements of transport planners are the transport planners themselves.
# By reducing barriers to entry in scenario-based transport modelling,
# the PCT methodology can empower decision-makers, planners and citizens to
# supplement their understanding of transport systems with evidence and plausible
# visions of the future.
```

# Author contribution statement {-}

The PCT was built as a collaborative effort. The project as a whole was led by JW, and the initial concept for the project came from JW and RL. AG led the creation of the model underlying the PCT, and the generation of estimates of cycling levels, health gains and carbon impacts in each scenario. RL led the processing of these modelled estimates for spatial visualisation in the online tool and coordinated the technical team in developing the online tool.  RA led the coordination of policy implementation and collection of practitioner feedback. AA led on the user interface. NB led the deployment of the PCT on a public facing server. RL led the writing of this manuscript, with input from all authors.

# Acknowledgements {-}

We would like to thank the following people for comments on earlier versions of the report and the development of the PCT:
Roger Geffen (Cycling UK), Tom Gutowski (Sustrans),
Helen Bowkett (Welsh Government),
John Parkin (University of the West of England) and Phil Tate.
Thanks to Simon Nutall and Martin Lucas-Smith for access to and instructions
on the use of the CycleStreets.net API.
Thanks to developers of open source software we have been able to make
the PCT free and open to the world.
We would also like to thank Brook Lyndhurst for assistance with the user testing,
and all participants in the user testing sessions.
We would also like to thank Shane Snow and other staff at the DfT for
specifying the project's aims and providing
feedback on early versions of the tool.

# Funding {-}

The work presented was funded by the Department for Transport (contract no. RM5019SO7766: "Provision of Research Programme into Cycling: Propensity to Cycle"), with contract facilitation and project management by Brook Lyndhurst in Phase 1, and by Atkins in Phase 2.
RL’s contribution was
supported by the Consumer Data Research Centre (ESRC grant number ES/L011891/1).
JW's contribution was supported by an MRC
Population Health Scientist Fellowship. JW’s and AA’s contribution was supported
by the Centre for Diet and Activity Research (CEDAR), a UKCRC Public Health
Research Centre of Excellence funded by the British Heart Foundation, Cancer
Research UK, Economic and Social Research Council, Medical Research Council, the
National Institute for Health Research (NIHR), and the Wellcome Trust. AG’s
contribution was supported by an NIHR post-doctoral fellowship. The views
reported in this paper are those of the authors and do not necessarily represent
those of the DfT, Brook Lyndhurst, Atkins the NIHR, the NHS or the Department for
Health.

```{r, echo=FALSE}
# # Using the tool
#
# This Appendix summarises the work from the perspective of practitioners
# by describing how the PCT may be used to inform the decision-making process.

# My affiliation: UKCRC Centre for Diet and Activity Research (CEDAR), MRC Epidemiology Unit, University of Cambridge, School of Clinical Medicine, Institute of Metabolic Science, Cambridge Biomedical Campus, Box 285, Cambridge CB2 0QQ, UK
#
# I also need institutional acknowledgement: Dr Woodcock’s contribution was undertaken under the auspices of the Centre for Diet and Activity Research (CEDAR), a UKCRC Public Health Research Centre of Excellence which is funded by the British Heart Foundation, Cancer Research UK, Economic and Social Research Council, Medical Research Council, the National Institute for Health Research, and the Wellcome Trust”
```

# References

```{r, echo=FALSE, eval=FALSE}
old <- setwd("flow-model")
system("latexdiff flow-model-s1.tex flow-model.tex > dif.tex")
setwd(old)

# zip file for arXiv
# zip("flow-model.zip", files = "flow-model")
file.copy("flow-model/flow-model.pdf", "~/Dropbox/PCT/2_WorkInProgress/Robin/flow-model-resubmission/", overwrite = T)
file.copy("flow-model/flow-model.docx", "~/Dropbox/PCT/2_WorkInProgress/Robin/flow-model-resubmission/", overwrite = T)
```

